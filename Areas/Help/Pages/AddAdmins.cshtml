@page
@model woodgrovedemo.Help.Pages.AddAdminsModel
@{
    ViewData["Title"] = "Add an admin account";
    Layout = "_Layout";
}



<h1 style="margin-top: 25px; margin-bottom: 25px;">Add an admin account</h1>

<div>

    <p>
        In Microsoft Entra External ID, a customer tenant represents your directory of consumer and guest accounts.
        With an administrator role, work and guest accounts can <a
            href="https://learn.microsoft.com/entra/external-id/customers/quickstart-tenant-setup" target="_blank"
            class="link-dark link-offset-2">manage the tenant</a>.

    </p>
    @await Html.PartialAsync("_StepsButtons.cshtml")

    <div class="bs-stepper vertical" id="Stepper">
        @await Html.PartialAsync("_Steps.cshtml", 6)

        <div class="bs-stepper-content">
            <div id="step-1" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger1">

                <h4>Prerequisites</h4>
                Before you start make sure you have configured the following:
                <ol>
                    <li><a href="CreateTenant">Create a tenant</a></li>

                </ol>

                <p>
                    To add an admin account, sign in to the <a href="https://entra.microsoft.com/" target="_blank"
                        class="link-dark link-offset-2">Microsoft Entra admin center</a> with
                    Global Administrator or Privileged Role Administrator permissions and browse to <b>Identity </b> >
                    <b> Users </b> > <b>All users</b>. Then, select <b>New user</b> > <b>Create new user</b>.
                </p>

                <a href="#" class="pop" onclick="return false;">
                    <img class="img-fluid border" src="~/Help/AddAdmins/Select-users.png">
                </a>
            </div>

            <div id="step-2" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger2">
                <p>
                    On the <b>Create new user</b> page, under <b>basics</b>, enter information for this admin:

                    <b>User principal name</b> (Required). The user name of the new user. For example, emily@woodgrovelive.com.
                    Eneter a <b>Name</b>.

                    Copy the autogenerated password provided in the <b>Password box</b>. You'll need to give this
                    password to
                    the admin to sign in for the first time.
                </p>

                <a href="#" class="pop" onclick="return false;">
                    <img class="img-fluid border" src="~/Help/AddAdmins/User-type-and-name.png">
                </a>
            </div>

            <div id="step-3" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger3">
                <p>
                    Under <b>Properties</b>, you can also enter a <b>First name</b> and <b>Last name</b> along with some other properties.
                </p>

                <a href="#" class="pop" onclick="return false;">
                    <img class="img-fluid border" src="~/Help/AddAdmins/Properties.png">
                </a>
            </div>

            <div id="step-4" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger4">
                <p>
                    To add administrative permissions for the user, add them to a Microsoft Entra role. You can
                    assign the user to be a <b>Global Administrator</b> or one or more of the limited administrator
                    roles in
                    Microsoft Entra ID. Under <b>Assignments</b>, and select <b>Add role</b>.
                    Then, find the role you want to add, and choose <b>Select</b>.
                </p>

                <a href="#" class="pop" onclick="return false;">
                    <img class="img-fluid border" src="~/Help/AddAdmins/Select-role.png">
                </a>

            </div>

            <div id="step-5" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger5">
                <p>
                    To create the account, select <b>Create</b>.
                </p>

                <a href="#" class="pop" onclick="return false;">
                    <img class="img-fluid border" src="~/Help/AddAdmins/Create.png">
                </a>

            </div>

            <div id="step-6" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="steppertrigger6">
                <div class="alert alert-success" role="alert">
                    <h4 class="alert-heading">Well done!</h4>
                    <p> The admin is created and added to your customer tenant. It's preferable to have at least one
                        admin account native to your customer tenant assigned the Global Administrator role. This
                        account can be considered a break-glass account or emergency access account.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="GraphApiContent">
        <h4 class="graph-header">Dependencies</h4>
        This script is self-contained.

        <h4 style="padding-top: 25px;padding-bottom: 5px;">1. Create a user</h4>
        <p>
            To <a href="https://learn.microsoft.com/graph/api/user-post-users" target="_blank"
                class="link-dark link-offset-2">create a user</a>, use the following Microsoft
            Graph and replace:
        <ul>
            <li><b>displayName</b> with the user display name.</li>
            <li><b>mailNickname</b> with a mail alias for the user. This property must be specified when a user is
                created.</li>
            <li><b>userPrincipalName</b> with the principal name (UPN) of the user. The general format is alias@domain,
                where the domain must be present in the tenant's collection of verified domains. </li>
            <li><b>password</b> with a temporary password that you will share with the user. During the first sign-in,
                the user will be asked to change their password.</li>
        </ul>

        The following example shows how to create a new user account for Adele Vance.
        </p>
        <code
            style="color: black;"><span class="method">POST</span> https://graph.microsoft.com/v1.0/applications</code>

        <pre>
{
    "accountEnabled": true,
    "<span class="highlight">displayName</span>": "Adele Vance",
    "<span class="highlight">mailNickname</span>": "AdeleV",
    "<span class="highlight">userPrincipalName</span>": "AdeleV@wggdemo.onmicrosoft.com",
    "passwordProfile": {
        "forceChangePasswordNextSignIn": true,
        "<span class="highlight">password</span>": "xWwvJ]6NMw+bWH-d"
    }
}
        </pre>

        <h5 class="graph-header">1.1 Copy the user ID</h5>
        From the response, copy the value of the <b>id</b>. For example:
        <pre>
{
    "@@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users/$entity",
    "<span class="highlight">id</span>": "623bf2e5-a0b7-44b0-a616-734299b8a944",
    ...
}        
        </pre>

        <h4 class="graph-header">2. Assign admin role</h4>
        <p>
            After the new user is created, <a
                href="https://learn.microsoft.com/graph/api/rbacapplication-post-roleassignments"
                target="_blank" class="link-dark link-offset-2">create a (unified) role assignment</a>.
            In the following Graph, replace the:

        <ul>
            <li><b>{user-id}</b> with the user <b>id</b> from the previous step.</li>
            <li><b>{role-id}</b> with one of the <a
                href="https://learn.microsoft.com/entra/identity/role-based-access-control/permissions-reference"
                target="_blank" class="link-dark link-offset-2">Microsoft Entra built-in roles</a>.</li>
        </ul>
        </p>

        <code
            style="color: black;"><span class="method">POST</span> https://graph.microsoft.com/v1.0/servicePrincipals</code>

        <pre>
{
    "@@odata.type": "#microsoft.graph.unifiedRoleAssignment",
    "principalId": "<span class="highlight">{user-id}</span>",
    "roleDefinitionId": "<span class="highlight">{role-id}</span>",
    "directoryScopeId": "/"
}
        </pre>

        <a class="btn btn-outline-primary btn-sm" data-bs-toggle="collapse" href="#collapseExample1" role="button"
            aria-expanded="false" aria-controls="collapseExample1">
            Example
        </a>
        <div class="collapse" id="collapseExample1">
            The following example assigns the <b>Global Administrator</b> role to Adele Vance
            <code
                style="color: black;"><span class="method">POST</span> https://graph.microsoft.com/v1.0/roleManagement/directory/roleAssignments</code>

            <pre class="example">
{
    "@@odata.type": "#microsoft.graph.unifiedRoleAssignment",
    "principalId": "623bf2e5-a0b7-44b0-a616-734299b8a944",
    "roleDefinitionId": "62e90394-69f5-4237-9190-012177145e10",
    "directoryScopeId": "/"
}
            </pre>
        </div>
    </div>
</div>
